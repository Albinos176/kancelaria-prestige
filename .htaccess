# ============================================================
# Kancelaria Księgowa Prestige – Anna Wagner
# .htaccess – Apache (Unixstorm)
# ============================================================

# ============================================================
# 1. WYMUSZENIE HTTPS
# ============================================================
<IfModule mod_rewrite.c>
    RewriteEngine On

    # HTTP → HTTPS
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]

    # Opcjonalnie: Wymuszenie www (odkomentuj jeśli chcesz www)
    # RewriteCond %{HTTP_HOST} !^www\. [NC]
    # RewriteRule ^(.*)$ https://www.%{HTTP_HOST}/$1 [R=301,L]
</IfModule>

# ============================================================
# 2. KOMPRESJA GZIP
# ============================================================
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE image/svg+xml
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE font/woff2
    AddOutputFilterByType DEFLATE font/woff
</IfModule>

# ============================================================
# 3. CACHE-CONTROL – długoterminowy dla statycznych zasobów
# ============================================================
<IfModule mod_expires.c>
    ExpiresActive On

    # Obrazy (WebP, JPG, PNG, SVG)
    ExpiresByType image/webp                "access plus 1 year"
    ExpiresByType image/jpeg                "access plus 1 year"
    ExpiresByType image/png                 "access plus 1 year"
    ExpiresByType image/svg+xml             "access plus 1 year"
    ExpiresByType image/x-icon              "access plus 1 year"

    # Fonty
    ExpiresByType font/woff2                "access plus 1 year"
    ExpiresByType font/woff                 "access plus 1 year"
    ExpiresByType application/font-woff2    "access plus 1 year"

    # CSS i JavaScript
    ExpiresByType text/css                  "access plus 1 year"
    ExpiresByType application/javascript    "access plus 1 year"
    ExpiresByType text/javascript           "access plus 1 year"

    # HTML i dane – krótki cache
    ExpiresByType text/html                 "access plus 1 hour"
    ExpiresByType application/json          "access plus 0 seconds"
</IfModule>

# Fallback Cache-Control headers
<IfModule mod_headers.c>
    <FilesMatch "\.(webp|jpg|jpeg|png|svg|ico|gif)$">
        Header set Cache-Control "public, max-age=31536000, immutable"
    </FilesMatch>
    <FilesMatch "\.(css|js)$">
        Header set Cache-Control "public, max-age=31536000, immutable"
    </FilesMatch>
    <FilesMatch "\.(woff|woff2)$">
        Header set Cache-Control "public, max-age=31536000, immutable"
    </FilesMatch>
    # HTML nie cache'ujemy agresywnie
    <FilesMatch "\.(html|htm|php)$">
        Header set Cache-Control "public, max-age=3600, must-revalidate"
    </FilesMatch>
</IfModule>

# ============================================================
# 4. SECURITY HEADERS
# ============================================================
<IfModule mod_headers.c>
    # Ochrona przed clickjackingiem
    Header always set X-Frame-Options "SAMEORIGIN"

    # Ochrona przed MIME sniffingiem
    Header always set X-Content-Type-Options "nosniff"

    # Wymusza HTTPS przez rok (HSTS)
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"

    # Referrer Policy – nie ujawniaj pełnego URL przy przejściu na inne strony
    Header always set Referrer-Policy "strict-origin-when-cross-origin"

    # Permissions Policy – wyłącz niepotrzebne browser APIs
    Header always set Permissions-Policy "camera=(), microphone=(), geolocation=(), payment=()"

    # Usuń nagłówek ujawniający wersję Apache
    Header unset X-Powered-By
    Header always unset X-Powered-By
</IfModule>

# ============================================================
# 5. UKRYJ WERSJĘ SERWERA
# ============================================================
ServerSignature Off

# ============================================================
# 6. BLOKADA DOSTEPU DO UKRYTYCH PLIKÓW
# ============================================================
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

# Blokuj dostęp do plików backupu
<FilesMatch "\.(bak|backup|old|orig|log|sql|sh)$">
    Require all denied
</FilesMatch>

# ============================================================
# 7. STRONA BŁĘDU 404
# ============================================================
ErrorDocument 404 /index.html
